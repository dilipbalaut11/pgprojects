CREATE EXTENSION wal_summary ;
CREATE TABLE lsn_limit(startlsn pg_lsn, endlsn pg_lsn);
CREATE TABLE t(a int, b varchar);
CREATE TABLE t1(a int);
insert into t values(generate_series(100,100000));
insert into t1 values(generate_series(100,1000000));
insert into lsn_limit values(pg_current_wal_lsn(), NULL);
INSERT INTO t VALUES (1);
INSERT INTO t VALUES (2);
INSERT INTO t1 VALUES (3);
insert into t1 values(generate_series(100,400000));
CREATE TABLE t2(a int);
INSERT INTO t2 VALUES (3);
insert into t select i, repeat('a', 1024) from generate_series(100,50000) as i;
update lsn_limit set endlsn = pg_current_wal_lsn();
select pg_current_wal_lsn();
INSERT INTO t1 VALUES (3);
select generate_wal_summary_file(startlsn, endlsn) from lsn_limit;
select print_wal_summary_file(startlsn, endlsn) from lsn_limit;
select read_wal_summary_relinfo(startlsn, endlsn, 1663, 5, relfilenode, 0) from lsn_limit, pg_class where relname='t';
truncate table lsn_limit;
